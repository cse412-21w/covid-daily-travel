<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>CSE 412 Project Demo</title>
        <link rel="stylesheet" href="style.css">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <!-- For using d3 -->
        <script src="https://d3js.org/d3.v6.min.js"></script>
        <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
        <script src="https://d3js.org/topojson.v2.min.js"></script>
        <script src="https://d3js.org/d3-queue.v3.min.js"></script>
        <script src="https://cdn.polyfill.io/v2/polyfill.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/topojson-client"></script>
        <!-- For using vega-lite -->
        <script src="https://cdn.jsdelivr.net/npm/vega"></script>
        <script src="https://cdn.jsdelivr.net/npm/vega-lite"></script>
        <script src="https://cdn.jsdelivr.net/npm/vega-lite-api"></script>
        <script src="https://cdn.jsdelivr.net/npm/vega-tooltip"></script>
        <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,900;1,400;1,900&display=swap" rel="stylesheet">
    </head>

    <body>

      <!-- Title -->

      <!-- <section class="title">
        <a href="/">CSE 412 Demo</a>
      </section> -->
      <section>
          <aside class="sidebar">
            <nav class="nav">
              <ul>
                <li class="active"><h2><a href="#welcome">welcome</a></h2></li>
                <li><h2><a href="#intro">intro</a></h2></li>
                <li><h2><a href="#fig1">covid: case</a></h2></li>
                <li><h2><a href="#fig2">covid: map</a></h2></li>
                <li><h2><a href="#fig3">covid: trip</a></h2></li>
                <li><h2><a href="#fig4">covid: age</a></h2></li>
                <li><h2><a href="#about">about us</a></h2></li>
              </ul>
            </nav>
          </aside>
      </section>

      <section>
        <div class = 'container1'>
          <div class = 'box1'>
            <div id="welcome"></div>
            <div class="content">
              <div class="container">
                <div class="neon">COVID-19 VS  </div>
                <div class="flux">TRAFFIC </div>
              </div>

            </div>
          </div>
        </div>

        <div class = 'container1'>
          <div class = 'box1'>
            <div id = 'intro'></div>
            <div class = 'content'>
              <h3>INTRO </h3>
                <p>
                <!-- <span>&emsp;&emsp;</span> -->
                The highly infectious disease COVID-19 pandemic has caused unprecedented live and economical loss in the United States, also poses a significant challenge for us. In different parts of the country, different types of people are doing different things that changed the pandemic in different scales, significantly or not, our behaviors are interfering with this world.
                  <a href='https://courses.cs.washington.edu/courses/cse412/21wi/fp.html'>course website</a>.
                </p>
          </div>
          </div>
        </div>
      </section>


      <!-- Figure 1 -->
      <section id = "Fig_1">
        <div class = 'container1'>
          <div class = 'box2'>
              <h3 id = "fig1"> Bubble Chart </h3>
                <p>
                <!-- <span>&emsp;&emsp;</span> -->
                Letâ€™s divide the whole country into states, in term of infection status, they appear to be very different. The difference can potentially result from travel behaviors, population, unemployment rate etc. and they all dramatically or slightly interfered the disease spreading processes. Macroscopically, whatever the effects from the factors are, the ultimate reflection we can observe is the confirmed cases in each state and the infection rate. The color of the bubbles below show how high the infection rate is, the higher the infection rate, the more saturated the color of the bubble. The size of the bubble shows the absolute number of the confirmed cases, the more the confirmed cases, the larger the bubble is.
                </p>
              <div id="d3_bubble_chart"></div>
          </div>
        </div>
      </section>

      <!-- Figure 2 -->
      <section id = "Fig2_map">
        <div class = 'container1'>
          <div class = 'box3'>
            <div id = 'fig2'></div>
            <h3> Interactive Map with Line Chart </h3>
              <p>  
                <!-- <span>&emsp;&emsp;</span> -->
                Letâ€™s dive deeper. In the previous page, we mentioned that different infection status can result from different factors. Again, different states behave very differently, try click on one of the states on the map and you will see the changings of 4 different factors that interfere with the infection status along with time.
                Travel population/State population reflects the portion of people traveled in the state, and if we take Travel population/State area into consideration, it will tell you the average travel population density of the state. Another potentially important factor to consider is the unemployment rate in the state, as its value determines peopleâ€™s time staying home and traveling. The last factor yet to consider is the total trips of the state, and this is obviously important because a higher number tend to produce more COVID case.
              </p>
            <div id="states">
              <div id="map-wrapper"></div>
              <div id="line"></div>
            </div>
            <div id="Category-selector"></div>           
          </div>
        </div>
      </section>
    
      <!-- igure 3 -->
      <section id = "vegaDemo">
        <div class = 'container1'>
          <div class = 'box1'> 
            <h3 id = "fig3">Trip Distribution Display</h3>
              <p>
              Yes, people still travel, but for very different distances. Researches have shown that travel distances are highly related to the infection rate. The travel distance can be categorized into 4 types of travel ranges: walkable distance [0 mile, 3 miles), short distance [3 mile, 25 miles), medium distance [25 miles, 100 miles), long distance [100 miles, +<span>&#8734;</span>). Here you can see the number of each type of travel range in the whole country, along with the number of each types of travel every month. Chances of getting infected highly depend on how many people you meet and how long you are exposed to the public. Although many other factors may also interfere with the result, the relatively positive relationship between travel distance and chance of getting infected is certain. Less travel is always a safer choice.
              <p>
                <div class = 'vega'>
              <div id="view"></div>
            </div>
            </div> 
          </div> 
          </div>
        </div>
      </section>

      <!-- igure 4 -->
      <section id = "vs3">

      <div class = 'container1'>
        <div class = 'box3'>
          <h3 id = "fig4">Interactive Map with Barchart</h3>
            <p>
              People are travelling, but different age groups travels differently, and peopleâ€™s travel patterns are very different between a normal year and a year with pandemic. When we put them side by side, it becomes more obvious that the overall travels have declined a lot in the past year. Child adolescence and senior adults have a declination in all types of travel ranges; however, the declination is not as dramatical as those of the Adult. Adults seems to be scared of the disease the most, you can easily recognize this if you select different groups from button and see the visualization.
            </p>
        <button onclick="update('Adult_trips.csv')">Adult</button>
        <button onclick="update('child_trips.csv')">Child</button>
        <button onclick="update('Adolescence_trips.csv')">Adolescence</button>
        <button onclick="update('Senior_Adult_trips.csv')">Senior Adult</button>
        <div id="d3_Fig4"></div>
        <script>
          // set the dimensions and margins of the graph
          var margin = {top: 30, right: 30, bottom: 70, left: 60},
              width = 460 - margin.left - margin.right,
              height = 400 - margin.top - margin.bottom;

          // append the svg object to the body of the page
          var svg = d3.select("#d3_Fig4")
            .append("svg")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom)
            .append("g")
              .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

          // Initialize the X axis
          var x = d3.scaleBand()
            .range([ 0, width ])
            .padding(0.2);
          var xAxis = svg.append("g")
            .attr("transform", "translate(0," + height + ")")

          // Initialize the Y axis
          var y = d3.scaleLinear()
            .range([ height, 0]);
          var yAxis = svg.append("g")
            .attr("class", "myYaxis")

          var subgroups = [];
          var groups = [];

          // A function that create / update the plot for a given variable:
          function update(selectedVar) {

            // Parse the Data
            d3.csv("https://raw.githubusercontent.com/ray439026783/covid-daily-travel/main/static/" + selectedVar).then(function(data) {
              
              // List of subgroups = header of the csv files = soil condition here
              // var subgroups = data.columns.slice(1)
              var subgroups = ['2019','2020']

              // List of groups = species here = value of the first column called group -> I show them on the X axis
              // var groups = d3.map(data, function(d){return(d.dist)}).keys()
              var groups= ['walk','short_drive','med_drive','long_drive']

              // X axis
              x.domain(groups)
                .range([0, width])
                .padding([0.2])

              xAxis.transition().duration(1000).call(d3.axisBottom(x))

              // Add Y axis
              // const ymax = d3.max(data, function(d) { return (d[2019])});
              
              y.domain([0, 85000])
                .range([ height, 0 ]);

              yAxis.transition().duration(1000).call(d3.axisLeft(y));

              // Another scale for subgroup position?
              var xSubgroup = d3.scaleBand()
                .domain(subgroups)
                .range([0, x.bandwidth()])
                .padding([0.05])

              // color palette = one color per subgroup
              var color = d3.scaleOrdinal()
                .domain(subgroups)
                .range(['#e41a1c','#377eb8'])

              // variable u: map data to existing bars
              var u = svg.selectAll("rect")
                .data(data)

              // Show the bars
              svg.append("g")
                .selectAll("g")
                // Enter in data = loop group per group
                .data(data)
                .enter()
                .append("g")
                .attr("transform", function(d) { return "translate(" + x(d.dist) + ",0)"; })
                .selectAll("rect")
                .data(function(d) { return subgroups.map(function(key) { return {key: key, value: d[key]}; }); })
                .enter().append("rect")
                  .attr("x", function(d) { return xSubgroup(d.key); })
                  .attr("y", function(d) { return y(d.value); })
                  .attr("width", xSubgroup.bandwidth())
                  .attr("height", function(d) { return height - y(d.value); })
                  .attr("fill", function(d) { return color(d.key); });

              // update bars
              u
                .enter()
                .append("rect")
                .merge(u)
                .transition()
                .duration(1000)
                  .attr("x", function(d) { return xSubgroup(d.key); })
                  .attr("y", function(d) { return y(d.value); })
                  .attr("width", xSubgroup.bandwidth())
                  .attr("height", function(d) { return height - y(d.value); })
                  .attr("fill", function(d) { return color(d.key); });

              u
                .exit()
                .remove()  
            })
             
          }

          // Initialize plot
          update('Adult_trips.csv')
        </script>>
        </div>
      </div>
      </section>

      <div class = 'container1'>
      <div class = 'box4'>
        <div id = 'about'></div>
        <div class = 'content'>
          <h3>About Us </h3>
            <p>
            <!-- <span>&emsp;&emsp;</span> -->
            Yifan Ling: Know about everything except knowledge about his major<br />
            <br />
            Zhijun Liu: Professional photographer with a 4GB storage card<br />
            <br />
            Kairui Huang: For some reason, he is the sunshine of our group<br />
            <br />
            Lu Liu: A random beautiful girl<br />
            <br />
              <a href='https://courses.cs.washington.edu/courses/cse412/21wi/fp.html'>course website</a>.
            </p>
        </div>
      </div>
      </div>

      <!-- igure footer -->
      <div class="footer">
              <ul>
                <li><a href="https://courses.cs.washington.edu/courses/cse412/21wi/">CSE 412 Data Visualization</a></li>
                <li><a href="http://www.washington.edu">University of Washington</a></li>
                <li><p>ðŸ‘‹</p></li>
              </ul>
      </div>

      <!-- it is recommended to put js files before </body> -->
      <!-- or check load event fot addEventListener() if you want to put js in the <head> -->
      <script src="vegaDemo.js"></script>
      <script src="Fig_1.js"></script>
      <script src="Fig2_zzl_2.js"></script>
    </body>

</html>
