<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>CSE 412 Project Demo</title>
        <link rel="stylesheet" href="https://cse412-21w.github.io/covid-daily-travel/style.3b307466.css">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <!-- For using d3 -->
        <script src="https://d3js.org/d3.v6.min.js"></script>
        <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
        <script src="https://d3js.org/topojson.v2.min.js"></script>
        <script src="https://d3js.org/d3-queue.v3.min.js"></script>
        <script src="https://cdn.polyfill.io/v2/polyfill.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/topojson-client"></script>
        <!-- For using vega-lite -->
        <script src="https://cdn.jsdelivr.net/npm/vega"></script>
        <script src="https://cdn.jsdelivr.net/npm/vega-lite"></script>
        <script src="https://cdn.jsdelivr.net/npm/vega-lite-api"></script>
        <script src="https://cdn.jsdelivr.net/npm/vega-tooltip"></script>
        <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,900;1,400;1,900&display=swap" rel="stylesheet">
    </head>

    <body>

      <!-- Title -->

      <!-- <section class="title">
        <a href="/">CSE 412 Demo</a>
      </section> -->
      <section>
          <aside class="sidebar">
            <nav class="nav">
              <ul>
                <li class="active"><h5><a href="#welcome">welcome</a></h5></li>
                <li><h5><a href="#intro">intro</a></h5></li>
                <li><h5><a href="#fig1">covid: case</a></h5></li>
                <li><h5><a href="#fig2">covid: map</a></h5></li>
                <li><h5><a href="#fig3">covid: trip</a></h5></li>
                <li><h5><a href="#fig4">covid: age</a></h5></li>
                <li><h5><a href="#about">about us</a></h5></li>
              </ul>
            </nav>
          </aside>
      </section>

      <section>
        <div class="container1">
          <div class="box1">
            <div id="welcome"></div>
            <div class="content">
              <div class="container">
                <div class="neon">COVID-19 VS  </div>
                <div class="flux">TRAFFIC </div>
              </div>

            </div>
          </div>
        </div>

        <div class="container1">
          <div class="box_intro">
            <div class="text_background"> <p>  </p> </div>
            <div id="intro"></div>
            <div class="content">
              <div class="lines">
                <div class="line"></div>
                <div class="line"></div>
                <div class="line"></div>
              </div>
              <!-- <h3>INTRO </h3> -->
                <p>
                <!-- <span>&emsp;&emsp;</span> -->
                The highly infectious disease COVID-19 pandemic has caused unprecedented live and economical loss in the United States, also poses a significant challenge for us. In different parts of the country, different types of people are doing different things that changed the pandemic in different scales, significantly or not, our behaviors are interfering with this world.
                  <!-- <a href='https://courses.cs.washington.edu/courses/cse412/21wi/fp.html'>course website</a>. -->
                </p>
          </div>
          </div>
        </div>
      </section>


      <!-- Figure 1 -->
      <section id="Fig_1">
        <div class="container1">
          <div class="box2">
            <div id="fig1"></div>
              <!-- <h3 id = "fig1"> Bubble Chart </h3> -->
                <p>
                <!-- <span>&emsp;&emsp;</span> -->
                Let‚Äôs divide the whole country into states, in term of infection status, they appear to be very different. The difference can potentially result from travel behaviors, population, unemployment rate etc. and they all dramatically or slightly interfered the disease spreading processes. Macroscopically, whatever the effects from the factors are, the ultimate reflection we can observe is the confirmed cases in each state and the infection rate. The color of the bubbles below show how high the infection rate is, the higher the infection rate, the more saturated the color of the bubble. The size of the bubble shows the absolute number of the confirmed cases, the more the confirmed cases, the larger the bubble is.
                </p>
              <div id="d3_bubble_chart"></div>
          </div>
        </div>
      </section>

      <!-- Figure 2 -->
      <section id="Fig2_map">
        <div class="container1">
          <div class="box3">
            <div id="fig2"></div>
            <!-- <h3> Interactive Map with Line Chart </h3> -->
              <p>  
                <!-- <span>&emsp;&emsp;</span> -->
                Let‚Äôs dive deeper. In the previous page, we mentioned that different infection status can result from different factors. Again, different states behave very differently, try click on one of the states on the map and you will see the changings of 4 different factors that interfere with the infection status along with time.
                Travel population/State population reflects the portion of people traveled in the state, and if we take Travel population/State area into consideration, it will tell you the average travel population density of the state. Another potentially important factor to consider is the unemployment rate in the state, as its value determines people‚Äôs time staying home and traveling. The last factor yet to consider is the total trips of the state, and this is obviously important because a higher number tend to produce more COVID case.

              </p>
              <div class="container">
              <div class="box5">
                <p>Hint:<br>1. Select a state<br>2. Select a category</p>
              </div>
              <div class="box6">
            <div id="states">
              <div id="map-wrapper"></div>
              <div id="line"></div>
            </div>
            <div class="box_cat"><h6>Category</h6></div>
            <div id="Category-selector"></div>  
            </div>         
          </div>
          </div>
        </div>
      </section>
    
      <!-- Figure 3 -->
      <section id="vegaDemo">
        <div class="container1">
          <div id="fig3"></div>
          <div class="box1"> 
            <!-- <h3 id = "fig3">Trip Distribution Display</h3> -->
              <p>
              Yes, people still travel, but for very different distances. Researches have shown that travel distances are highly related to the infection rate. The travel distance can be categorized into 4 types of travel ranges: walkable distance [0 mile, 3 miles), short distance [3 mile, 25 miles), medium distance [25 miles, 100 miles), long distance [100 miles, +<span>&#8734;</span>). Here you can see the number of each type of travel range in the whole country, along with the number of each types of travel every month. Chances of getting infected highly depend on how many people you meet and how long you are exposed to the public. Although many other factors may also interfere with the result, the relatively positive relationship between travel distance and chance of getting infected is certain. Less travel is always a safer choice.
              </p><p>
                <div class="vega">
              <div id="view"></div>
            </div>
            </p></div> 
          </div> 
          
        
      </section>

      <!-- Figure 4 -->
      <section class="Figure_4">
        <div class="container1">
        <div class="box3">
          <div id="fig4"></div>
          <p>
            People are travelling, but different age groups travels differently, and people‚Äôs travel patterns are very different between a normal year and a year with pandemic. When we put them side by side, it becomes more obvious that the overall travels have declined a lot in the past year. Child adolescence and senior adults have a declination in all types of travel ranges; however, the declination is not as dramatical as those of the Adult. Adults seems to be scared of the disease the most, you can easily recognize this if you select different groups from button and see the visualization.
          </p>
          <button class="fig4_button1" ;="" onclick="update('Adult_trips.csv'); updatemap('Adult'); updatemap('Adult'); update_ymax(45000)">Adult</button>
          <button class="fig4_button2" ;="" onclick="update('child_trips.csv'); updatemap('Child'); updatemap('Child'); update_ymax(25000)">Child</button>
          <button class="fig4_button3" ;="" onclick="update('Adolescence_trips.csv'); updatemap('Adolescence'); updatemap('Adolescence'); update_ymax(30000)">Adolescence</button>
          <button class="fig4_button4" ;="" onclick="update('Senior_Adult_trips.csv'); updatemap('Senior_Adult'); updatemap('Senior_Adult'); update_ymax(12000)">Senior Adult</button>
          <div class="fig4_container"></div>
            <div id="Fig4_map"></div>
            <div class="box_black1"><p></p></div>
            <div id="Fig4_bar"></div>
            <div class="box_black2"><p></p></div>
          </div>
        </div>

        <script>// Map Chart
var width_map = 350;
var height_map = 550;
var margin = {
  top: 50,
  bottom: 50,
  left: 50,
  right: 50
};
var width = 350;
var height = 450; // The svg

var svg_map = d3.select("#Fig4_map").append("svg").attr("width", width_map + 400).attr("height", height_map).append("g").attr("transform", "translate(" + margin.left + "," + 90 + ")"); // Map and projection

var projection = d3.geoMercator().center([-108, 35]) // GPS of location to zoom on
.scale(650) // This is like the zoom
.translate([width_map / 2, height_map / 2]); // create a tooltip

var Tooltip_map = d3.select("#Fig4_map").append("div").attr("class", "tooltip_map");

function updatemap(ageGroup) {
  d3.json("https://raw.githubusercontent.com/ray439026783/covid-daily-travel/ray439026783-patch-4/static/highlight_" + ageGroup + "_trips.json").then(function (state_data) {
    // Load external data and boot
    d3.json("https://raw.githubusercontent.com/PublicaMundi/MappingAPI/master/data/geojson/us-states.json").then(function (data) {
      // Three function that change the tooltip when user hover / move / leave a cell
      var mouseover = function mouseover(d) {
        Tooltip_map.style("opacity", 0.8);
      };

      var mousemove = function mousemove(d, i) {
        Tooltip_map.html('State: ' + i.state + "<br>" + "Percentage of " + ageGroup + ": " + i.Pct).style("left", d3.select(this).attr('cx') - 150 + "px").style("bottom", d3.select(this).attr('cy') + "px");
      };

      var mouseleave = function mouseleave(d) {
        Tooltip_map.style("opacity", 0);
      }; // Draw the map


      svg_map.append("g").selectAll("path").data(data.features).enter().append("path").attr("fill", "black").attr("d", d3.geoPath().projection(projection)).style("stroke", "rgb(157, 91, 212)").attr("stroke-width", 16).style("opacity", 0.4); // update map

      var w = svg_map.append("g").selectAll("path").data(data.features);
      w.enter().append("path").attr("fill", "black").attr("d", d3.geoPath().projection(projection)).style("stroke", "#deeaee").attr("stroke-width", 2).style("opacity", 0.4);
      w.enter().append("path").attr("fill", "black").attr("d", d3.geoPath().projection(projection)).style("stroke", "rgb(157, 91, 212)").attr("stroke-width", 10).style("opacity", 0.2);
      w.exit().remove(); // Add a scale for bubble size

      var size = d3.scaleLinear().domain([1, 100]) // What's in the data
      .range([8, 20]); // Size in pixel
      // variable v: map data to exisitng ciricles

      var v = svg_map.selectAll().data(state_data); // update ciricle

      v.enter().append("circle").merge(v).attr("cx", function (d) {
        return projection([d.long, d.lat])[0];
      }).attr("cy", function (d) {
        return projection([d.long, d.lat])[1];
      }).attr("r", 10).attr("class", "circle").style("fill", "rgb(255, 133, 245)").attr("stroke", "rgb(110, 255, 224)").attr("stroke-width", 3).attr("fill-opacity", .6).on("mouseover", mouseover).on("mousemove", mousemove).on("mouseleave", mouseleave);
      v.exit().remove();
    });
  });
} // Bar Chaert
// append the svg object to the body of the page


var svg = d3.select("#Fig4_bar").append("svg").attr("width", width + margin.left + margin.right).attr("height", height + margin.top + margin.bottom).append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")"); // create a tooltip

var Tooltip_bar = d3.select("#Fig4_bar").append("div").attr("class", "tooltip_bar"); // Initialize the X axis

var x = d3.scaleBand().range([0, width + margin.left + margin.right]).padding(0.2);
var xAxis = svg.append("g").attr("class", "axis_fig4").attr("transform", "translate(0," + height + ")"); // Initialize the Y axis

var y = d3.scaleLinear().range([height, 0]);
var yAxis = svg.append("g").attr("class", "axis_fig4");
var subgroups = [];
var groups = [];

function update_ymax(newYmax) {
  var ymax = newYmax;
} // A function that create / update the plot for a given variable:


function update(selectedVar) {
  // Parse the Data
  d3.csv("https://raw.githubusercontent.com/ray439026783/covid-daily-travel/ray439026783-patch-5/static/" + selectedVar).then(function (data) {
    var mouseover = function mouseover(d) {
      Tooltip_bar.style("opacity", 0.8);
    };

    var mousemove = function mousemove(d, i) {
      Tooltip_bar.html("Number of Trips: " + i.value + ' million').style("left", d3.select(this).attr('x') + "px").style("top", d3.select(this).attr('y') + "px");
    };

    var mouseleave = function mouseleave(d) {
      Tooltip_bar.style("opacity", 0);
    }; // List of subgroups = header of the csv files = soil condition here
    // var subgroups = data.columns.slice(1)


    var subgroups = ['year2019', 'year2020']; // List of groups = species here = value of the first column called group -> I show them on the X axis
    // var groups = d3.map(data, function(d){return(d.dist)}).keys()

    var groups = ['Walkable', 'Commute', 'Outdoor', 'Traveling']; // X axis

    x.domain(groups).range([0, width]).padding([0.2]);
    xAxis.transition().duration(1000).call(d3.axisBottom(x)); // Add Y axis
    // const ymax = d3.max(data, function(d) { return d.year2019});
    // const ymax = d3.max(data, function(d) { return +d.value; })

    y.domain([0, 45000]).range([height, 0]); //y.domain([0, ymax])
    //  .range([ height, 0 ]);

    yAxis.transition().duration(1000).call(d3.axisLeft(y)); // Another scale for subgroup position?

    var xSubgroup = d3.scaleBand().domain(subgroups).range([0, x.bandwidth()]).padding([0.05]); // variable u: map data to existing bars

    var u = svg.selectAll("rect").data(data);
    /************* Ë∞ÉÊ∏êÂèò ****************/
    // Ë∞ÉÊï¥Ê∏êÂèòÈ¢úËâ≤

    var bgGradient1 = svg.append('linearGradient').attr('id', 'bg-gradient1').attr('gradientTransform', 'rotate(90)');
    bgGradient1.append('stop').attr('stop-color', 'rgb(5, 232, 183)').attr('offset', '0%');
    bgGradient1.append('stop').attr('stop-color', 'white').attr('offset', '100%'); // Á¨¨‰∫åÁßçÊ∏êÂèòÈ¢úËâ≤

    var bgGradient2 = svg.append('linearGradient').attr('id', 'bg-gradient2').attr('gradientTransform', 'rotate(90)');
    bgGradient2.append('stop').attr('stop-color', 'rgb(255, 103, 242)').attr('offset', '0%');
    bgGradient2.append('stop').attr('stop-color', 'white').attr('offset', '100%'); // ÊääÊï¥‰∏™ËÉåÊôØÊ∂ÇÊàêÊ∏êÂèòÈ¢úËâ≤

    svg.append('g').attr('clip-path', "url(#clip-bar-rects)").append('rect').attr('x', 5).attr('y', 0).attr('width', width).attr('height', height); // color palette = one color per subgroup

    var color = d3.scaleOrdinal().domain(subgroups) //.range(["url(#bg-gradient1)", "url(#bg-gradient2)"])
    .range(["rgb(110, 255, 224)", "rgb(255, 103, 242)"]); // ÊääËÉåÊôØÁöÑÊ∏êÂèòÈ¢úËâ≤Ââ™ÊàêÊü±Áä∂Âûã

    svg.attr('id', 'clip-bar-rects').selectAll('bar').data(data).enter().append("g").attr("transform", function (d) {
      return "translate(" + x(d.dist) + ",0)";
    }).selectAll("rect").data(function (d) {
      return subgroups.map(function (key) {
        return {
          key: key,
          value: d[key]
        };
      });
    }).enter().append('rect').attr("x", function (d) {
      return xSubgroup(d.key);
    }).attr("y", function (d) {
      return y(d.value);
    }).attr("width", xSubgroup.bandwidth()).attr("height", function (d) {
      return height - y(d.value);
    }).style('fill', function (d) {
      return color(d.key);
    }) //.attr("stroke-width", 2)
    //.style("filter", "url(#drop-shadow)")
    //.attr("stroke", function(d) { return color(d.key); })
    //.style("text-shadow","0 0 5px #fff, 0 0 10px #fff, 0 0 15px #ff67f2, 0 0 20px #ff67f2")
    //.attr("fill-opacity", .6)
    .on("mouseover", mouseover).on("mousemove", mousemove).on("mouseleave", mouseleave);
    u.exit().remove(); // add legend

    svg.append("circle").attr("cx", 280).attr("cy", 20).attr("r", 6).style("fill", "rgb(5, 232, 183)").style('font-family', 'Tahoma');
    svg.append("circle").attr("cx", 280).attr("cy", 50).attr("r", 6).style("fill", "rgb(255, 103, 242)").style('font-family', 'Tahoma');
    svg.append("text").attr("x", 290).attr("y", 20).text("2019").style("font-size", "15px").style("fill", "rgb(5, 232, 183)").style('font-family', 'Tahoma').attr("alignment-baseline", "middle");
    svg.append("text").attr("x", 290).attr("y", 50).text("2020").style("font-size", "15px").style("fill", "rgb(255, 103, 242)").style('font-family', 'Tahoma').attr("alignment-baseline", "middle");
    /************* MOD ****************/

    /* 
    // Show the bars
    svg.append("g")
      .selectAll("g")
      // Enter in data = loop group per group
      .data(data)
      .enter()
      .append("g")
      .attr("transform", function(d) { return "translate(" + x(d.dist) + ",0)"; })
      .selectAll("rect")
      .data(function(d) { return subgroups.map(function(key) { return {key: key, value: d[key]}; }); })
      .enter()
      .append("rect")
        .attr("x", function(d) { return xSubgroup(d.key); })
        .attr("y", function(d) { return y(d.value); })
        .attr("width", xSubgroup.bandwidth())
        .attr("height", function(d) { return height - y(d.value); })
        .attr("fill", function(d) { return color(d.key); })
        // .attr('strok', 'red')
        // .attr('broder-radius', 150)
        // .attr('opacity', 0.5)
      .on("mouseover", mouseover)
      .on("mousemove", mousemove)
      .on("mouseleave", mouseleave)
      // update bars
    u
      .enter()
      .append("rect")
      .merge(u)
      .transition()
      .duration(1000)
        .attr("x", function(d) { return xSubgroup(d.key); })
        .attr("y", function(d) { return y(d.value); })
        .attr("width", xSubgroup.bandwidth())
        .attr("height", function(d) { return height - y(d.value); })
        .attr("fill", function(d) { return color(d.key); })
     u
      .exit()
      .remove()
    */
  });
} // Initialize plot


updatemap('Adult');
update('Adult_trips.csv');</script>
        

      </section>

      <div class="container1">
      <div class="box4">
        <div id="about"></div>
        <div class="content">
          <h3>About Us </h3>
            <p>
            <!-- <span>&emsp;&emsp;</span> -->
            Yifan Ling: Know about everything except knowledge about his major<br>
            <br>
            Zhijun Liu: Professional photographer with a 4GB storage card<br>
            <br>
            Kairui Huang: For some reason, he is the sunshine of our group<br>
            <br>
            Lu Liu: A random beautiful girl<br>
            <br>
              <!-- <a href='https://courses.cs.washington.edu/courses/cse412/21wi/fp.html'>course website</a>. -->
            </p>
        </div>
      </div>
      </div>

      <!-- igure footer -->
      <div class="footer">
              <ul>
                <li><a href="https://courses.cs.washington.edu/courses/cse412/21wi/">CSE 412 Data Visualization</a></li>
                <li><a href="https://github.com/cse412-21w/covid-daily-travel">github</a></li>
                <li><p>üëã</p></li>
              </ul>
      </div>

      <!-- it is recommended to put js files before </body> -->
      <!-- or check load event fot addEventListener() if you want to put js in the <head> -->
      <script src="https://cse412-21w.github.io/covid-daily-travel/vegaDemo.1cb23884.js"></script>
      <script src="https://cse412-21w.github.io/covid-daily-travel/Fig_1.d083d157.js"></script>
      <script src="https://cse412-21w.github.io/covid-daily-travel/Fig2_zzl_2.5cd286ea.js"></script>
    </body>

</html>
